<section ng-controller="ProfileController" class="show-profile" data-user-id="<%= @user.id %>">

	<div ng-show="profile.loaded && profile.loadError" class="container mt-4">
		<div class="alert alert-danger">
			<p>{{profile.loadError}}</p>
		</div>
	</div>
	<div class="ajax_loading profile" ng-show="!profile.loaded">Loading profile...</div>

	<section class="cover_photo justify-content-center"
					ng-show="profile.loaded && !profile.loadError && mode == 'view'"
					ng-style="{'background-image':'url('+profile.data.coverPhoto.image+')'}"
					ng-click="editCoverPhoto()" ng-class="{'editable': profile.isMe}">
		<div class="col-12">
			<a ng-click="editCoverPhoto()" href='#' class="align-middle" ng-if="profile.isMe && profile.data.coverPhoto.image.length == 0">
				<i class="fas fa-image"></i>
			</a>
		</div>
	</section>

	<section class="container d-flex" id="basic_info" ng-show="profile.loaded && !profile.loadError && mode == 'view'">
		<div ng-style="{'background-image':'url('+profile.data.profilePhoto.image+')'}"
				 class="profile_circle_image rounded-circle" ng-click="editProfilePhoto()"></div>
		<div class="pl-3">
			<h5>{{ profile.data.displayName }}</h5>
			<h6 class="text-muted">{{ profile.data.username }}</h6>
		</div>
	</section>

	<section class="container d-flex" class="d-flex" id="stats_info" ng-show="profile.loaded && !profile.loadError && mode == 'view'">
		<div class="stats p-2 flex-fill">
			<label>Ratings</label>
			<span>{{ profile.data.ratings }}</span>
		</div>
		<div class="stats p-2 flex-fill">
			<label>Followers</label>
			<span>{{ profile.data.followers }}</span>
		</div>
		<div class="stats p-2 flex-fill">
			<label>Following</label>
			<span>{{ profile.data.following }}</span>
		</div>
	</section>

	<section class="container" ng-show="profile.loaded && profile.isMe && !profile.loadError && mode == 'view'">
		<button class="btn btn-outline-success btn-block mt-3 mb-4" ng-click="editProfile()">Edit Profile</button>
	</section>

	<section class="container" id="more_info" ng-show="profile.loaded && !profile.loadError && mode == 'view'">
		<p>
			<i class="fas fa-calendar-alt"></i> <span class="pl-3">Joined {{profile.data.joinedAt}}</span>
		</p>

		<p ng-if="profile.data.location.length > 0">
			<i class="fas fa-map-marker-alt"></i>
			<span class="pl-3">{{ profile.data.location }}</span>
		</p>
		<p ng-if="!profile.data.location || profile.data.location.length == 0">
			<a href='#' ng-click="editProfile()">
				<i class="fas fa-map-marker-alt"></i>
				<span class="pl-3">Add Location</span>
			</a>
		</p>

		<p ng-if="profile.data.bio.length > 0">
			{{ profile.data.bio }}
		</p>
		<p ng-if="!profile.data.bio || profile.data.bio.length == 0">
			<a href='#' ng-click="editProfile()">
				<i class="far fa-plus-square"></i>
				<span class="pl-3">Add Bio</span>
			</a>
		</p>
	</section>

	<section class="my-4" id="public_activity" ng-show="profile.loaded && !profile.loadError && mode == 'view'">
		<ul class="nav nav-tabs nav-fill d-flex">
		  <li class="nav-item">
		    <a class="nav-link active" id="activity-all-tab" data-toggle="tab" href="#activity-all">
		      All
		    </a>
		  </li>
		  <li class="nav-item">
		    <a class="nav-link" id="activity-ratings-tab" data-toggle="tab" href="#activity-ratings">
		      Ratings
		    </a>
		  </li>
		  <li class="nav-item">
		    <a class="nav-link" id="activity-shares-tab" data-toggle="tab" href="#activity-shares">
		      Shares
		    </a>
		  </li>
		  <li class="nav-item">
		    <a class="nav-link" id="activity-exchanges-tab" data-toggle="tab" href="#activity-exchanges">
		      Exchanges
		    </a>
		  </li>
		</ul>

		<div class="tab-content container" id="activity-tabs">
			<div class="tab-pane fade pt-4 show active" id="activity-all" role="tabpanel" aria-labelledby="activity-all-tab">
				All
			</div>
			<div class="tab-pane fade pt-4" id="activity-ratings" role="tabpanel" aria-labelledby="activity-ratings-tab">
				Ratings
			</div>
			<div class="tab-pane fade pt-4" id="activity-shares" role="tabpanel" aria-labelledby="activity-shares-tab">
				Shares
			</div>
			<div class="tab-pane fade pt-4" id="activity-exchanges" role="tabpanel" aria-labelledby="activity-exchanges-tab">
				Exchanges
			</div>
		</div>
	</section>


	<div class="overlay edit_profile" ng-show="mode == 'edit'"></div>

	<!-- Edit profile fields -->
	<section id="edit_profile_form_box" ng-if="mode == 'edit'">
		<div class="cover_photo" class="justify-content-center"
					ng-style="{'background-image':'url('+profile.data.coverPhoto.image+')'}"
					ng-click="editCoverPhoto()" ng-class="{'editable': profile.isMe}">
			<a ng-click="editCoverPhoto()" href='#' class="align-middle">
				<i class="fas fa-image"></i>
			</a>
		</div>

		<div ng-style="{'background-image':'url('+profile.data.profilePhoto.image+')'}"
				class="profile_circle_image rounded-circle" id="edit_profile_photo_inside">
			<a ng-click="editProfilePhoto()" href='#' class="align-middle" ng-if="mode == 'edit'">
				<i class="fas fa-image"></i>
			</a>
		</div>

		<div class="container py-4">
    	<p ng-show="profile.errors.main" class="alert alert-danger">{{profile.errors.main}}</p>
			<%= form_for(current_user, url: "/users") do |f| %>
			  <div class="form-group">
			    <%= f.label :display_name %><br />
		    	<p ng-show="profile.errors.displayName" class="alert alert-danger">{{profile.errors.displayName}}</p>
			    <%= f.text_field :display_name, autofocus: true, class: "form-control", required: '', 'ng-model': "profile.data.displayName" %>
			  </div>

			  <div class="form-group">
			    <%= f.label :username %><br />
		    	<p ng-show="profile.errors.username" class="alert alert-danger">{{profile.errors.username}}</p>
		    	<div class="input-group mb-2">
  	        <div class="input-group-prepend">
  	          <div class="input-group-text">@</div>
  	        </div>
				    <%= f.text_field :username, autofocus: true, class: "form-control", required: '', 'ng-model': "profile.data.username" %>
				  </div>
				</div>

			  <div class="form-group">
			    <%= f.label :location %><br />
		    	<p ng-show="profile.errors.location" class="alert alert-danger">{{profile.errors.location}}</p>
			    <%= f.text_field :location, class: "form-control", 'ng-model': "profile.data.location" %>
			  </div>

	  	  <div class="form-group">
	  	    <%= f.label :bio %><br />
	      	<p ng-show="profile.errors.bio" class="alert alert-danger">{{profile.errors.bio}}</p>
	  	    <%= f.text_area :bio, class: "form-control", 'ng-model': "profile.data.bio", rows: 6, maxlength: bio_max_length %>
	  	    <p class="hint text-right pr-1">
	  	    	<small ng-if="!profile.data.bio.length"><%= bio_max_length %> character maximum</small>
	  	    	<small ng-if="profile.data.bio.length">{{profile.data.bio.length}} / <%= bio_max_length %> characters</small>
	  	    </p>
	  	  </div>

	  	  <div class="buttons d-flex justify-content-between pt-3">
	  	  	<button ng-click="cancelEditProfile($event)" class="btn btn-outline-success">Cancel</button>
	  	  	<button ng-click="saveProfile($event)" class="btn btn-success">Save</button>
	  	  </div>
			<% end %>
		</div>
	</section>

	<script id="editProfilePhoto" type="script/x-mustache">
		<%= render partial: 'edit_photo_modal', locals: { type: "profile" } %>
	</script>

	<script id="editCoverPhoto" type="script/x-mustache">
		<%= render partial: 'edit_photo_modal', locals: { type: "cover" } %>
	</script>

</section>