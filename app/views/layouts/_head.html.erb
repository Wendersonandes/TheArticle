<!DOCTYPE html>
<html>
  <head>
    <title><%= yield_page_title(default_page_title) %></title>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <%= csrf_meta_tags %>
    <%= csp_meta_tag %>

    <link rel="profile" href="http://gmpg.org/xfn/11">
    <link href="https://fonts.googleapis.com/css?family=Montserrat:400,500,600,700" rel="stylesheet">
    <link rel="shortcut icon" type="image/x-icon" href="<%= asset_url('icons/favicon.png') %>"/>

    <!-- Standard SEO tags -->
    <meta name="description"  content="<%= yield_meta_tag(:description, default_meta_description) %>" />
    <% if content_for?(:meta_image) %>
    <meta itemprop="image" content="<%= yield_meta_tag(:image) %>" />
    <% end %>

    <!-- OpenGraph SEO tags -->
    <meta property="og:title" content="<%= yield_page_title(default_page_title) %>" />
    <meta property="og:url" content="<%= request.url %>" />
    <meta property="og:description"  content="<%= yield_meta_tag(:description, default_meta_description) %>" />
    <meta property="og:site_name" content="TheArticle" />
    <meta property="og:type" content="<%= page_og_type %>" />
    <% if content_for?(:meta_image) %>
    <meta property="og:image" content="<%= yield_meta_tag(:image) %>" />
    <% end %>

    <!-- Twitter SEO tags -->
    <meta property="twitter:title" content="<%= yield_page_title(default_page_title) %>" />
    <meta name="twitter:description"  content="<%= yield_meta_tag(:description, default_meta_description) %>" />
    <meta name="twitter:card" content="summary_large_image" />
    <meta name="twitter:domain" content="www.thearticle.com" />
    <meta name="twitter:site" content="@TweetTheArticle" />
    <% if content_for?(:meta_image) %>
    <meta name="twitter:image" content="<%= yield_meta_tag(:image) %>" />
    <% end %>

    <% if content_for?(:"meta_canonical") %>
    <link rel="canonical" href="<%= yield_meta_tag(:canonical) %>" />
    <% end %>

    <% if is_article_page? && @article %>
    <meta property="article:published_time" content='<%= @article.published_at.strftime("%Y-%m-%dT%H:%M:%SZ") %>' />
    <meta property="article:modified_time" content='<%= @article.published_at.strftime("%Y-%m-%dT%H:%M:%SZ") %>' />
    <% end %>

    <% if content_for?(:meta_keywords) %>
    <meta name="keywords" content="<%= yield_meta_tag(:keywords) %>" />
    <% end %>
    <% if content_for?(:meta_entities) %>
    <meta name="entities" content="<%= yield_meta_tag(:entities) %>" />
    <% end %>
    <% if content_for?(:meta_concepts) %>
    <meta name="concepts" content="<%= yield_meta_tag(:concepts) %>" />
    <% end %>

    <%= javascript_include_tag 'setup', 'data-turbolinks-track' => true %>
    <% if page_requires_tinymce? %>
      <%= javascript_include_tag 'tinymce', 'data-turbolinks-track' => true %>
    <% end %>

    <% if(!is_development?) %>
      <!-- Global site tag (gtag.js) - Google Analytics -->
      <script async src="https://www.googletagmanager.com/gtag/js?id=<%= ga_tracking_id %>"></script>
      <script>
        window.dataLayer = window.dataLayer || [];
        function gtag(){dataLayer.push(arguments);}
        gtag('js', new Date());
        gtag('config', '<%= ga_tracking_id %>', {
          'custom_map': {'dimension1': 'browserType'}
        });
        var ua = navigator.userAgent || navigator.vendor || window.opera;
        var browserType = ua.indexOf("FBAN") > -1 || ua.indexOf("FBAV") > -1 ? 'Facebook' : 'Regular';
        gtag('event', 'loaded', {'browserType': browserType });
      </script>
    <% end %>

    <%= render 'layouts/ad-javascript' if show_ads? %>

    <% if page_requires_google_maps? %>
      <% maps_api_key = Rails.application.credentials.google_maps_api_key[Rails.env.to_sym] %>
      <script src="https://maps.googleapis.com/maps/api/js?libraries=places&key=<%= maps_api_key %>" type="text/javascript"></script>
    <% end %>

    <%= stylesheet_link_tag  'desktop', media: 'all', 'data-turbolinks-track': 'reload' %>
    <% if is_tablet? %>
      <%= stylesheet_link_tag  'tablet', media: 'all', 'data-turbolinks-track': 'reload' %>
    <% end %>

    <script src="<%= asset_url('vendor/modernizr.js') %>" type="text/javascript"></script>

    <% if is_article_page? && @article %>
      <script type="application/ld+json">
        <%= render(partial: 'articles/structured_data.json', locals: { article: @article }).html_safe %>
      </script>
    <% end %>

    <!-- Alexa -->
    <script type="text/javascript">
      _atrk_opts = { atrk_acct:"YKHHt1FYxz20cv", domain:"thearticle.com",dynamic: true};
      (function() { var as = document.createElement('script'); as.type = 'text/javascript'; as.async = true; as.src = "https://certify-js.alexametrics.com/atrk.js"; var s = document.getElementsByTagName('script')[0];s.parentNode.insertBefore(as, s); })();
    </script>
    <noscript><img src="https://certify.alexametrics.com/atrk.gif?account=YKHHt1FYxz20cv" style="display:none" height="1" width="1" alt="" /></noscript>

    <% if @contributor.present? && @contributor.has_a_social_profile? %>
      <script type="application/ld+json">
      {
        "@context" : "http://schema.org",
        "@type" : "Person",
        "name" : "<%= @contributor.display_name %>",
        "url" : "<%= contributor_url(slug: @contributor.slug) %>",
        "sameAs" : ["<%= @contributor.social_url_list.html_safe %>"]
      }
      </script>
    <% end %>

    <% if Rails.env.production? %>
      <!-- Facebook Pixel Code -->
        <script>
          !function(f,b,e,v,n,t,s)
          {if(f.fbq)return;n=f.fbq=function(){n.callMethod?
          n.callMethod.apply(n,arguments):n.queue.push(arguments)};
          if(!f._fbq)f._fbq=n;n.push=n;n.loaded=!0;n.version='2.0';
          n.queue=[];t=b.createElement(e);t.async=!0;
          t.src=v;s=b.getElementsByTagName(e)[0];
          s.parentNode.insertBefore(t,s)}(window,document,'script',
          'https://connect.facebook.net/en_US/fbevents.js');
          fbq('init', '303025330596251');
          fbq('track', 'PageView');
        </script>

        <noscript>
          <img height="1" width="1" src="https://www.facebook.com/tr?id=303025330596251&ev=PageView&noscript=1"/>
        </noscript>
      <!-- End Facebook Pixel Code -->
    <% end %>

    <% if Rails.env.production? %>
      <script>
      (function() {
          top._r3z = top._r3z || {};
          var _r3z = top._r3z;
          _r3z.doubleServe = {
              adServer: "DFP",
              configId: top.location.hostname,
              adSlotId: "[AD_SLOT_ID]",
              engagementTracker: "%%CLICK_URL_UNESC%%",
              googleAnalyticsTrackingId: "UA-XXXXXXXX-X",
              singleAd: false,
              safetyTimeout: 5000,
              test: false
          };

          var cdns = {
              cdn1: "https://cdn3.rezonence.com/",
              cdn2: "https://e43e8e18e725ae6b22e0-f0fde0bbc5469096ab6f7c4eba4934a9.ssl.cf3.rackcdn.com/",
              s3: "https://r3z-test-eu.S3.amazonaws.com/"
          };
          _r3z.doubleServe.iframeWindow = self;
          if (_r3z.doubleServe.test) { cdns.cdn1 = cdns.cdn2 = cdns.s3; }
          var hd = top.document.head || top.document.getElementByTagName("head")[0];
          var s1 = top.document.createElement("script");
          s1.onerror = function() {
              var s2 = top.document.createElement("script");
              s2.src = cdns.cdn2 + "Pub/" + _r3z.doubleServe.configId + "/doubleserve.js";
              hd.insertBefore(s2, hd.firstChild);
          };
          s1.src = cdns.cdn1 + "Pub/" + _r3z.doubleServe.configId + "/doubleserve.js";
          hd.insertBefore(s1, hd.firstChild);
      })();
      </script>
    <% end %>
  </head>

  <body class="<%= body_classes %>" onunload="" ng-app="TheArticleNG">
    <% if show_ads? %>
    <div id="ads_top" class="bg-light py-4">
      <div class="container">
        <div class="row">
          <div class="col-2"></div>
          <div class="col-8 d-flex justify-content-center">
            <div id="ads_top_box" class="ads_box">
              <!-- /<%= ad_publisher_id %>/thearticle_<%= ad_page_type %>/skin -->
              <div id='div-gpt-ad-<%= ad_page_id %>-2' style='height:1px; width:1px;'>
                <script>googletag.cmd.push(function() { googletag.display('div-gpt-ad-<%= ad_page_id %>-2'); });</script>
              </div>
              <!-- /<%= ad_publisher_id %>/thearticle_<%= ad_page_type %>/rezonence -->
              <div id='div-gpt-ad-<%= ad_page_id %>-5' style='width: 3px; height: 3px;'>
              Â  <script>googletag.cmd.push(function() { googletag.display('div-gpt-ad-<%= ad_page_id %>-5'); });</script>
              </div>
              <!-- /<%= ad_publisher_id %>/thearticle_<%= ad_page_type %>/topbanner -->
              <div id='div-gpt-ad-<%= ad_page_id %>-3'>
                <script>googletag.cmd.push(function() { googletag.display('div-gpt-ad-<%= ad_page_id %>-3'); });</script>
              </div>
            </div>
          </div>
          <div class="col-2"></div>
        </div>
      </div>
    </div>
    <% end %>